/*! romantic by Jake Craige 2014-01-05 */
!function(a,b){a.Romantic=b(a,{},a._)}(this,function(a,b,c){function d(){return(65536*(1+Math.random())|0).toString(16).substring(1)}function e(){return d()+d()+"-"+d()+"-"+d()+"-"+d()+"-"+d()+d()+d()}c.mixin({deepIndex:function(a,b){var d=-1;return c.some(a,function(a,e){return c.isEqual(a,b)?(d=e,!0):void 0}),d}});var f=[];b.VERSION="0.0.1",b.String={capitalize:function(a){return a.substr(0,1).toUpperCase()+a.substr(1)}};var g=b.LocalStorage=function(){this.initialize.apply(this,arguments)};c.extend(g.prototype,{initialize:function(a){return this.dbName=a.dbName,this.tableName=a.tableName,this.setup(),this},setup:function(){this.setupDatabase(),this.setupTable()},setupDatabase:function(){this.database=null,this.database=new b.LocalStorage.DB(this.dbName)},setupTable:function(){c.include(this.tables(),this.tableName)?this.table=this.database.get(this.tableName):this.setTable([])},replace:function(a){return null==a&&(a=this.table),this.setTable(a)},setTable:function(a){return a?(this.database.set(this.tableName,a),this.table=this.database.get(this.tableName)):this.setup(),this.table},tables:function(){return this.database.tables()},destroyAll:function(){var a=this.database.destroy(this.tableName);return this.setup(),a},all:function(){return c.clone(this.table)},find:function(a){var b,d,e,f,g;if(d=a,c.isObject(a)&&!c.isArray(a)&&(d=a.id,e=a.cid),g=function(a){return c.isNumber(a)&&a>=0?!0:c.isString(a)?!0:void 0},(d||0===d)&&!g(d))throw new Error("id: "+d+" is not a valid id");if((e||0===e)&&!g(e))throw new Error("cid: "+e+" is not a valid id");return b=this,lazyFindMatch=function(a,d){return c.find(b.table,function(b){return b[a]==d?!0:void 0})},(d||0===d)&&(f=lazyFindMatch("id",d)),f||((e||0===e)&&(f=lazyFindMatch("cid",e)),!f&&d&&(f=lazyFindMatch("cid",d))),c.clone(f)},create:function(a){return a.cid=e(),this.table.push(a),this.replace(),c.clone(a)},update:function(a){var b,d;if(b=this.find(a),d=c.deepIndex(this.table,b),!b)throw new Error("Couldnt find record with that id or cid");return b=c.extend(b,a),this.table[d]=b,this.replace(),c.clone(b)},destroy:function(a){var b,d;return(b=this.find(a))?(d=c.deepIndex(this.table,b),void 0!==d&&this.table.splice(d,1),this.replace(),c.clone(b)):!1}});var h=b.LocalStorage.DB=function(){this.initialize.apply(this,arguments)};c.extend(h.prototype,{initialize:function(a){return this._dbName=a,this.reload(),this},reload:function(){return this._database=store.namespace(this._dbName),this._database},all:function(){return this._database.getAll()},tables:function(){return c.keys(this.all())},get:function(a){return this._database.get(a)},set:function(a,b){return this._database.set(a,b),this.get(a)},destroy:function(a){return this._database.remove(a)}});var i=b.Table=function(){this.initialize.apply(this,arguments)};c.extend(i.prototype,{initialize:function(a,b){if(!a&&!this.tableName)throw new Error("You must provide a table name when initializing a table");return b||(b={}),b=c.defaults(b,{dbName:"romantic"}),this._setStore(a,b),this},_setStore:function(a,c){c.tableName=this.tableName||a,this._store=this.adapter?new this.adapter(c):new b.LocalStorage(c)},replace:function(a){this._store.setTable(this.filterData(a))},logTable:function(){console.table(this._store.table)},log:function(){console.log(this._store.table)},filterData:function(a){if(this.schema){var d;return d=["cid","id"],c.isArray(this.schema)?c.each(this.schema,function(a){d.push(a)}):c.isObject(this.schema)&&c.each(this.schema,function(e,f){""===e||c.isFunction(e)&&e(a[f])?d.push(f):(acceptedTypes=["array","object","string","number","boolean"],c.each(acceptedTypes,function(g){e===g&&c["is"+b.String.capitalize(g)](a[f])&&d.push(f)}))}),c.pick(a,d)}return a},create:function(a){return this._store.create(this.filterData(a)),this.find(a)},all:function(){return c.map(this._store.all(),function(a){return this.filterData(a)},this)},find:function(a){return this._store.find(a)},update:function(a){return this._store.update(this.filterData(a)),this.find(a)},destroyAll:function(){return this._store.destroyAll()},destroy:function(a){return this._store.destroy(a)}});var j=["forEach","each","map","collect","reduce","foldl","inject","reduceRight","foldr",,"detect","filter","select","reject","every","some","any","include","contains","invoke","max","min","toArray","size","first","head","take","initial","rest","tail","drop","last","without","difference","indexOf","shuffle","lastIndexOf","isEmpty","chain","sample","where","findWhere"];c.each(j,function(a){i.prototype[a]=function(){var b=f.slice.call(arguments);return b.unshift(this._table),c[a].apply(c,b)}});var k=["groupBy","countBy","sortBy","indexBy"];c.each(k,function(a){i.prototype[a]=function(b,d){var e=c.isFunction(b)?b:function(a){return a[b]};return c[a](this._table,e,d)}});var l=function(a,b){var d,e=this;d=a&&c.has(a,"constructor")?a.constructor:function(){return e.apply(this,arguments)},c.extend(d,e,b);var f=function(){this.constructor=d};return f.prototype=e.prototype,d.prototype=new f,a&&c.extend(d.prototype,a),d.__super__=e.prototype,d};return h.extend=g.extend=i.extend=l,b});