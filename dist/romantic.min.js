/*! romantic by Jake Craige 2014-03-16 */
!function(a,b){a.Romantic=b(a,{},a._)}(this,function(a,b,c){function d(){return(65536*(1+Math.random())|0).toString(16).substring(1)}function e(){return d()+d()+"-"+d()+"-"+d()+"-"+d()+"-"+d()+d()+d()}c.mixin({deepIndex:function(a,b){var d=-1;return c.some(a,function(a,e){return c.isEqual(a,b)?(d=e,!0):void 0}),d}});var f=[];b.VERSION="0.0.1",b.String={capitalize:function(a){return a.substr(0,1).toUpperCase()+a.substr(1)}};var g=b.LocalForage=function(){this.initialize.apply(this,arguments)};c.extend(g.prototype,{initialize:function(a){return this.dbName=a.dbName,this.tableName=a.tableName,this.setup(),this},setup:function(a){this.setupDatabase(),this.setupTable(a)},setupDatabase:function(){this.database=null,this.database=new b.LocalForage.DB(this.dbName)},setupTable:function(a){var b=this;c.include(this.tables(),this.tableName)?this.database.get(this.tableName,function(d){b.table=d,a&&a(c.clone(d))}):(this.table=[],this.setTable([]),a&&a([]))},replace:function(a,b){return null==a&&(a=this.table),this.setTable(a,b)},setTable:function(a,b){var d=this;return c.isArray(a)?this.database.set(this.tableName,a,function(a){d.table=a,b&&b(a)}):this.setup(b),this.table},tables:function(){return this.database.tables()},destroyAll:function(a){var b=this;return this.database.destroy(this.tableName,function(){b.setup(a)})},all:function(a){return a(c.clone(this.table))},find:function(a,b){var d,e,f,g,h;if(e=a,c.isObject(a)&&!c.isArray(a)&&(e=a.id,f=a.cid),h=function(a){return c.isNumber(a)&&a>=0?!0:c.isString(a)?!0:void 0},(e||0===e)&&!h(e))throw new Error("id: "+e+" is not a valid id");if((f||0===f)&&!h(f))throw new Error("cid: "+f+" is not a valid id");return d=this,lazyFindMatch=function(a,b){return c.find(d.table,function(c){return c[a]==b?!0:void 0})},(e||0===e)&&(g=lazyFindMatch("id",e)),g||((f||0===f)&&(g=lazyFindMatch("cid",f)),!g&&e&&(g=lazyFindMatch("cid",e))),b(c.clone(g))},create:function(a,b){var d;return a.cid=e(),this.table.push(a),d=this.table,this.replace(d,function(){b(c.clone(a))})},update:function(a,b){var d,e=this;return this.find(a,function(f){if(d=c.deepIndex(e.table,f),!f)throw new Error("Couldnt find record with that id or cid");f=c.extend(f,a),e.table[d]=f,e.replace(e.table,function(){return b(c.clone(f))})})},destroy:function(a,b){var d=this;return this.find(a,function(a){var e;return a?(e=c.deepIndex(d.table,a),void 0!==e&&d.table.splice(e,1),d.replace(d.table,function(){b(c.clone(a))}),void 0):(b(!1),void 0)})}});var h=b.LocalForage.DB=function(){this.initialize.apply(this,arguments)};c.extend(h.prototype,{initialize:function(a){return this._dbName=a,this.reload(),this},reload:function(){return this._database=localforage.namespace(this._dbName),this._database},all:function(a){var b=this;return this._database._getKeysCache(function(c){a&&!c&&a([]),promises=c.map(function(a){b._database.get(a)}),Promise.all(promises).then(function(b){a&&a(b)})})},tables:function(){return c.keys(this.all())},get:function(a,b){return this._database.getItem(a,b)},set:function(a,b,c){return this._database.setItem(a,b,c)},destroy:function(a,b){return this._database.removeItem(a,b)}});var i=b.Table=function(){this.initialize.apply(this,arguments)};c.extend(i.prototype,{initialize:function(a,b){if(!a&&!this.tableName)throw new Error("You must provide a table name when initializing a table");return b||(b={}),b=c.defaults(b,{dbName:"romantic"}),this._setStore(a,b),this},_setStore:function(a,c){c.tableName=this.tableName||a,this._store=this.adapter?new this.adapter(c):new b.LocalForage(c)},replace:function(a,b){this._store.setTable(this.filterData(a),b)},logTable:function(){console.table(this._store.table)},log:function(){console.log(this._store.table)},filterData:function(a){if(this.schema){var d;return d=["cid","id"],c.isArray(this.schema)?c.each(this.schema,function(a){d.push(a)}):c.isObject(this.schema)&&c.each(this.schema,function(e,f){""===e||c.isFunction(e)&&e(a[f])?d.push(f):(acceptedTypes=["array","object","string","number","boolean"],c.each(acceptedTypes,function(g){e===g&&c["is"+b.String.capitalize(g)](a[f])&&d.push(f)}))}),c.pick(a,d)}return a},create:function(a,b){return this._store.create(this.filterData(a),b)},all:function(a){var b=this;return this._store.all(function(d){a(c.map(d,function(a){return this.filterData(a)},b))})},find:function(a,b){return this._store.find(a,b)},update:function(a,b){return this._store.update(this.filterData(a),b)},destroyAll:function(a){return this._store.destroyAll(a)},destroy:function(a,b){return this._store.destroy(a,b)}});var j=["forEach","each","map","collect","reduce","foldl","inject","reduceRight","foldr",,"detect","filter","select","reject","every","some","any","include","contains","invoke","max","min","toArray","size","first","head","take","initial","rest","tail","drop","last","without","difference","indexOf","shuffle","lastIndexOf","isEmpty","chain","sample","where","findWhere"];c.each(j,function(a){i.prototype[a]=function(){var b=f.slice.call(arguments);return b.unshift(this._table),c[a].apply(c,b)}});var k=["groupBy","countBy","sortBy","indexBy"];c.each(k,function(a){i.prototype[a]=function(b,d){var e=c.isFunction(b)?b:function(a){return a[b]};return c[a](this._table,e,d)}});var l=function(a,b){var d,e=this;d=a&&c.has(a,"constructor")?a.constructor:function(){return e.apply(this,arguments)},c.extend(d,e,b);var f=function(){this.constructor=d};return f.prototype=e.prototype,d.prototype=new f,a&&c.extend(d.prototype,a),d.__super__=e.prototype,d};return h.extend=g.extend=i.extend=l,b});