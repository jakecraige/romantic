<!DOCTYPE html>

<html>
<head>
  <title>romantic.db.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>romantic.db.js</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              <h2 id="romanticdb-js">RomanticDB.js</h2>

            </div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p>v0.0.1</p>
<p>Copyright (c)2013 Jake Craige
Distributed under MIT license</p>
<p><a href="http://jcraige.com">http://jcraige.com</a></p>
<p><em>TODO:</em></p>
<ul>
<li>Set up query functions to accept an array</li>
<li>Remove store2 dependency</li>
</ul>
<h2 id="description-">Description:</h2>

            </div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p>Library for managing client side data in web and mobile applications.</p>
<p>It treats the browser localStorage like a database and provides and interface
for managing and querying the data.</p>
<h2 id="dependencies-">Dependencies:</h2>

            </div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <ul>
<li>Underscore - <a href="https://github.com/jashkenas/underscore">https://github.com/jashkenas/underscore</a></li>
<li>Store2     - <a href="https://github.com/nbubna/store">https://github.com/nbubna/store</a></li>
</ul>
<h2 id="example-">Example:</h2>

            </div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <pre><code>var users          = new Romantic.Table(&#39;users&#39;, {dbName: &#39;apple&#39;});
var john           = users.create({ id: 1, firstName: &#39;John&#39;, lastName: &#39;Doe&#39; });
var foundJohn      = users.find(1); // or users.find(john)
john.firstName     = &#39;Jane&#39;;
john               = users.update(john);
var destroyedJohn  = users.destroy(1); // or users.destroy(john)</code></pre>

            </div>
            
            <div class="content"><div class='highlight'><pre>(<span class="function"><span class="keyword">function</span><span class="params">(root, factory)</span> {</span>

  root.Romantic = factory(root, {}, root._);

}(<span class="keyword">this</span>, <span class="function"><span class="keyword">function</span><span class="params">(root, Romantic, _)</span> {</span></pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p>Create local references to array methods we&#39;ll want to use later.(Backbone)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="keyword">var</span> array = [];

  Romantic.VERSION = <span class="string">'0.0.1'</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <h2 id="table-constructor">Table Constructor</h2>

            </div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="keyword">var</span> Table = Romantic.Table = <span class="function"><span class="keyword">function</span><span class="params">(name, options)</span> {</span>
    <span class="keyword">this</span>.initialize.apply(<span class="keyword">this</span>, arguments);
  };</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <h2 id="table-methods">Table Methods</h2>

            </div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>  _.extend(Table.prototype, {</pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <p>When initializing a table you pass in it&#39;s name and options</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    initialize: <span class="function"><span class="keyword">function</span><span class="params">(name, options)</span> {</span>
      options || (options = {});

      options = _.defaults(options, {
        dbName: <span class="string">'romantic'</span>
      });

      <span class="keyword">this</span>._setDatabase(options);
      <span class="keyword">this</span>._setTable(name);
      <span class="keyword">return</span> <span class="keyword">this</span>;
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <p>This sets up the database instance inside the object</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    _setDatabase: <span class="function"><span class="keyword">function</span><span class="params">(options)</span> {</span>
      <span class="keyword">var</span> dbName;
      dbName = options.dbName;
      <span class="keyword">this</span>._database =  store.namespace(dbName);
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <p>This sets up the table instance and table name inside the object</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    _setTable: <span class="function"><span class="keyword">function</span><span class="params">(name)</span> {</span>
      <span class="keyword">this</span>._tableName = name;

      <span class="keyword">if</span>(!<span class="keyword">this</span>._database.has(name)) { <span class="keyword">this</span>._database(name, []); }

      <span class="keyword">this</span>._table = <span class="keyword">this</span>._database(name);
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <p>Takes an optional table parameter(array of objects), this allows you to
completely replace the database with a new data set.</p>
<p>It is used internally after the create, update, destroy functions</p>
<p>Example:</p>
<pre><code>var cars = [{make: &#39;Chevrolet&#39;, cid: 1}, {make: &#39;Dodge&#39;, cid: 2}];
var carsTable = new Romantic.DB.Table(&#39;cars&#39;);
carsTable.save(cars);</code></pre>

            </div>
            
            <div class="content"><div class='highlight'><pre>    save: <span class="function"><span class="keyword">function</span><span class="params">(table)</span> {</span>
      <span class="keyword">if</span>(table == <span class="literal">null</span>) { table = <span class="keyword">this</span>._table; }
      <span class="keyword">this</span>._database(<span class="keyword">this</span>._tableName, table);
      <span class="keyword">return</span> table;
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <p>Takes in an object of attributes and saves it with a unique cid</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    create: <span class="function"><span class="keyword">function</span><span class="params">(data)</span> {</span>
      data.cid = _.uniqueId(<span class="string">'c'</span>);
      <span class="keyword">this</span>._table.push(data);
      <span class="keyword">this</span>.save();
      <span class="keyword">return</span> data;
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-16">&#182;</a>
              </div>
              <p>Returns all data in the table as an array</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    all: <span class="function"><span class="keyword">function</span><span class="params">()</span> {</span>
      <span class="keyword">return</span> <span class="keyword">this</span>._table;
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-17">&#182;</a>
              </div>
              <p>Accepts either a data object that has an id/cid attribute or just a cid
or id. If it contains both, the <code>id</code> will take precendence</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    find: <span class="function"><span class="keyword">function</span><span class="params">(data)</span> {</span>
      <span class="keyword">var</span> id;
      id = data;

      <span class="keyword">if</span>(data <span class="keyword">instanceof</span> Object) {
        id = data.id || data.cid;
      }</pre></div></div>
            
        </li>
        
        
        <li id="section-18">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-18">&#182;</a>
              </div>
              <p>Purposely using == and not === as to prevent type issues from coming
up when using localStorage as it could really be stored either way</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      match = _.find(<span class="keyword">this</span>._table, <span class="function"><span class="keyword">function</span><span class="params">(row)</span>{</span>
        <span class="keyword">return</span> row.id == id || row.cid == id
      });
      <span class="keyword">return</span> match;
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-19">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-19">&#182;</a>
              </div>
              <p>Accepts a data object with changed values and will update and save the
data</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    update: <span class="function"><span class="keyword">function</span><span class="params">(data)</span> {</span>
      <span class="keyword">var</span> row, index;
      row   = <span class="keyword">this</span>.find(data);
      index = _.indexOf(<span class="keyword">this</span>._table, row);

      <span class="keyword">if</span>(!row) { <span class="keyword">return</span> <span class="literal">false</span>; }
      <span class="keyword">this</span>._table[index] = _.extend(row, data);
      <span class="keyword">this</span>.save();
      <span class="keyword">return</span> row;
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-20">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-20">&#182;</a>
              </div>
              <p>This destroys all data in the table and saves it</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    destroyAll: <span class="function"><span class="keyword">function</span><span class="params">()</span> {</span>
      <span class="keyword">this</span>._database.remove(<span class="keyword">this</span>.tableName);
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-21">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-21">&#182;</a>
              </div>
              <p>Takes an Object or Id/Cid and finds it in the table and destroys it</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    destroy: <span class="function"><span class="keyword">function</span><span class="params">(data)</span> {</span>
      <span class="keyword">var</span> row;
      row = <span class="keyword">this</span>.find(data);
      <span class="keyword">this</span>._table = _.without(<span class="keyword">this</span>._table, row);
      <span class="keyword">this</span>.save();
      <span class="keyword">return</span> row;
    }

  });</pre></div></div>
            
        </li>
        
        
        <li id="section-22">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-22">&#182;</a>
              </div>
              <p>Code Borrowed From Backbone
<a href="http://backbonejs.org">http://backbonejs.org</a></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="keyword">var</span> methods = [<span class="string">'forEach'</span>, <span class="string">'each'</span>, <span class="string">'map'</span>, <span class="string">'collect'</span>, <span class="string">'reduce'</span>, <span class="string">'foldl'</span>,
    <span class="string">'inject'</span>, <span class="string">'reduceRight'</span>, <span class="string">'foldr'</span>, ,<span class="string">'detect'</span>, <span class="string">'filter'</span>, <span class="string">'select'</span>,
    <span class="string">'reject'</span>, <span class="string">'every'</span>, <span class="string">'some'</span>, <span class="string">'any'</span>, <span class="string">'include'</span>, <span class="string">'contains'</span>, <span class="string">'invoke'</span>,
    <span class="string">'max'</span>, <span class="string">'min'</span>, <span class="string">'toArray'</span>, <span class="string">'size'</span>, <span class="string">'first'</span>, <span class="string">'head'</span>, <span class="string">'take'</span>, <span class="string">'initial'</span>, <span class="string">'rest'</span>,
    <span class="string">'tail'</span>, <span class="string">'drop'</span>, <span class="string">'last'</span>, <span class="string">'without'</span>, <span class="string">'difference'</span>, <span class="string">'indexOf'</span>, <span class="string">'shuffle'</span>,
    <span class="string">'lastIndexOf'</span>, <span class="string">'isEmpty'</span>, <span class="string">'chain'</span>, <span class="string">'sample'</span>];</pre></div></div>
            
        </li>
        
        
        <li id="section-23">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-23">&#182;</a>
              </div>
              <p>Mix in each Underscore method as a proxy to <code>Table#_table</code>.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  _.each(methods, <span class="function"><span class="keyword">function</span><span class="params">(method)</span> {</span>
    Table.prototype[method] = <span class="function"><span class="keyword">function</span><span class="params">()</span> {</span>
      <span class="keyword">var</span> args = array.slice.call(arguments);
      args.unshift(<span class="keyword">this</span>._table);
      <span class="keyword">return</span> _[method].apply(_, args);
    };
  });</pre></div></div>
            
        </li>
        
        
        <li id="section-24">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-24">&#182;</a>
              </div>
              <p>Underscore methods that take a property name as an argument.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="keyword">var</span> attributeMethods = [<span class="string">'groupBy'</span>, <span class="string">'countBy'</span>, <span class="string">'sortBy'</span>, <span class="string">'indexBy'</span>];</pre></div></div>
            
        </li>
        
        
        <li id="section-25">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-25">&#182;</a>
              </div>
              <p>Use attributes instead of properties.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  _.each(attributeMethods, <span class="function"><span class="keyword">function</span><span class="params">(method)</span> {</span>
    Table.prototype[method] = <span class="function"><span class="keyword">function</span><span class="params">(value, context)</span> {</span>
      <span class="keyword">var</span> iterator = _.isFunction(value) ? value : <span class="function"><span class="keyword">function</span><span class="params">(model)</span> {</span>
        <span class="keyword">return</span> model[value];
      };
      <span class="keyword">return</span> _[method](<span class="keyword">this</span>._table, iterator, context);
    };
  });

  <span class="keyword">var</span> extend = <span class="function"><span class="keyword">function</span><span class="params">(protoProps, staticProps)</span> {</span>
    <span class="keyword">var</span> parent = <span class="keyword">this</span>;
    <span class="keyword">var</span> child;</pre></div></div>
            
        </li>
        
        
        <li id="section-26">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-26">&#182;</a>
              </div>
              <p>The constructor function for the new subclass is either defined by you
(the &quot;constructor&quot; property in your <code>extend</code> definition), or defaulted
by us to simply call the parent&#39;s constructor.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="keyword">if</span> (protoProps &amp;&amp; _.has(protoProps, <span class="string">'constructor'</span>)) {
      child = protoProps.constructor;
    } <span class="keyword">else</span> {
      child = <span class="function"><span class="keyword">function</span><span class="params">()</span>{</span> <span class="keyword">return</span> parent.apply(<span class="keyword">this</span>, arguments); };
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-27">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-27">&#182;</a>
              </div>
              <p>Add static properties to the constructor function, if supplied.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    _.extend(child, parent, staticProps);</pre></div></div>
            
        </li>
        
        
        <li id="section-28">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-28">&#182;</a>
              </div>
              <p>Set the prototype chain to inherit from <code>parent</code>, without calling
<code>parent</code>&#39;s constructor function.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="keyword">var</span> Surrogate = <span class="function"><span class="keyword">function</span><span class="params">()</span>{</span> <span class="keyword">this</span>.constructor = child; };
    Surrogate.prototype = parent.prototype;
    child.prototype = <span class="keyword">new</span> Surrogate;</pre></div></div>
            
        </li>
        
        
        <li id="section-29">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-29">&#182;</a>
              </div>
              <p>Add prototype properties (instance properties) to the subclass,
if supplied.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="keyword">if</span> (protoProps) _.extend(child.prototype, protoProps);</pre></div></div>
            
        </li>
        
        
        <li id="section-30">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-30">&#182;</a>
              </div>
              <p>Set a convenience property in case the parent&#39;s prototype is needed
later.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    child.__super__ = parent.prototype;

    <span class="keyword">return</span> child;
  };</pre></div></div>
            
        </li>
        
        
        <li id="section-31">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-31">&#182;</a>
              </div>
              <p>Set up inheritance for the Table</p>
<p>End of Code Borrowed From Backbone
<a href="http://backbonejs.org">http://backbonejs.org</a></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  Table.extend = extend;

  <span class="keyword">return</span> Romantic;
}));</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
